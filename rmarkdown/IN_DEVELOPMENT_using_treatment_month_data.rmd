---
title: "In development - Dental Data Pack using treatment month data"
subtitle: "National"
date: "`r paste(format(Sys.time(), '%B, %Y'), ' - Reporting up to end of', format(Sys.Date() - lubridate::weeks(4), '%B, %Y'))`"
output:
  xaringan::moon_reader:
    css: [theme.css, nhsr-fonts.css]
    self_contained: true
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}

library(tidyverse)
library(readxl)
library(DBI)
library(odbc)
library(reactable) #make sure you have the latest version by doing install.packages("reactable")
library(downloadthis)
library(lubridate)
library(readr)


#source in all file from plot folder
for (f in list.files(path = "../R/03 plot_functions/", pattern="*.R$")) {
    source(paste0("../R/03 plot_functions/", f))
}

for (f in list.files(path = "../R/02 format_data_functions/", pattern="*.R$")) {
    source(paste0("../R/02 format_data_functions/", f))
}

#sort out STP ICB changes
STP_ICB_lookup_codes <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/STP_ICB_lookup_codes.xlsx")

UDA_treatment_month_FD_Apr23 <- read_csv("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/new_treatment_month_data/UDA_treatment_month_FD_Apr23.csv") #####put in shared folder
UDA_treatment_month_non_FD_Apr23 <- read_csv("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/new_treatment_month_data/UDA_treatment_month_non_FD_Apr23.csv")

UDA_treatment_month_FD_Apr23 <- clean_treatment_month_columns(UDA_treatment_month_FD_Apr23)
UDA_treatment_month_non_FD_Apr23 <- clean_treatment_month_columns(UDA_treatment_month_non_FD_Apr23)

#pull data from NCDR
UDA_calendar_data <- pull_UDA_calendar_data()
UOA_calendar_data <- pull_UOA_calendar_data()
UDA_scheduled_data <- pull_UDA_scheduled_data()
UOA_scheduled_data <- pull_UOA_scheduled_data()
payments_to_dentists <- pull_payments_to_dentist()

historical_UDA_scheduled_data <- pull_UDA_scheduled_historical_data()
historical_UDA_scheduled_data <- rename(historical_UDA_scheduled_data, month = data_month)

historical_UOA_scheduled_data <- pull_UOA_scheduled_historical_data()
historical_UOA_scheduled_data <- rename(historical_UOA_scheduled_data, month = data_month)

#change column names and add regions
UDA_calendar_data <- rename(UDA_calendar_data, month = data_month)
UOA_calendar_data <- UOA_calendar_data %>%
  rename(month = data_month) %>%
  mutate(contract_number = as.numeric(contract_number),
         UOA_total = as.numeric(UOA_total))

    
# UOA_calendar_data <- left_join( region_STP_lookup, by = c("contract_number", "name_or_company_name", "commissioner_name"))
UDA_scheduled_data <- rename(UDA_scheduled_data, month = data_month)
UOA_scheduled_data <- rename(UOA_scheduled_data, month = data_month)

UDA_scheduled_data <- mutate(UDA_scheduled_data, month = as.Date(month))
UOA_scheduled_data <- mutate(UOA_scheduled_data, month = as.Date(month))


#Read local 111 file
dental_data_111 <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/111_pathways_data/dental_data_111.xlsx")

#############still to fix
prototype_contracts <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/prototype_contracts.xlsx")
contractor_categories <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/contractor_categories.xlsx")
contractor_categories <- contractor_categories %>%
  mutate(contract_number = as.numeric(contract_number))
contract_demographics <- readRDS("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/contract_demographics.rds")

#read in unique patients
#unique_patients_rolling <- readRDS("../data/unique_patients/unique_patients_rolling.rds")
unique_patients_rolling <- pull_unique_patients_data()

#read in recalls 
dental_recalls_STP_2018_22 <- readRDS("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/dental_recalls_STP_2018_22.rds")

#read in CDS data
CDS_data <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/CDS/CDS_data.xlsx")
CDS_data <- clean_CDS_data_colnames(CDS_data)

#read in hand backs data
contract_handbacks <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/contract_handbacks.xlsx")

#read in and clean complaints data
Dental_Access_Complaints_Data_June_22 <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/complaints/Dental Access Complaints Data June 22.xlsx")
dental_complaints <- clean_complaints_data(Dental_Access_Complaints_Data_June_22)

#UDA value data
UDA_values <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/UDA_values.xlsx")
UDA_UOA_value_data <- pull_UDA_UOA_value()

#Pull patient charge data
patient_exemption_data <- pull_patient_exemption_data()
patient_exemption_data <- clean_patient_exemption_data()

#pull health inequalities data
health_inequalities_data <- pull_health_inequalities()

missing_contracts_data <- read_excel("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/data_for_monthly_report/missing_contract_details.xlsx")

#DCP_data <- read.csv("N:/_Everyone/Primary Care Group/SMT_Dental DENT 2022_23-008/DCP_data/DPC_v1_Oct_2022.csv") 
DCP_data <- pull_dcp_data()

BPE_data <- pull_BPE_data()

band2_split_data <- pull_band2_split_data()

new_vs_return_data <- pull_new_vs_returning_patients()

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

#avoid standard form
options(scipen=999)

# Suppress summarise info
options(dplyr.summarise.inform = FALSE)

```


name: contents
#### Contents 1 

 <font size="2">
#### Dental
 * [Table of number of contracts by MY category](#contracts-table)
 * [UDA activity](#short-uda-activity)
 * [UDA activity by MY category](#short-uda-activity-my-cat)
 * [Cumulative UDA delivery per quarter](#cumulative-udas)
 * [YTD UDA delivery](#YTD-udas)
 * [Historic UDA delivery](#historic-udas)
 * [UDA delivery profile across months](#uda-delivery-profile)
 * [Banded courses of treatment time series](#banded-cots)
 * [Banded courses of treatment time series as % of 2019 delivery](#banded-cots-index)
 * [Percentage of FP17s in each band 2 sub-category](#band2-split-FP17-perc)
 * [UDAs delivered by patient charge status](#patient-charge)
 * [Contractors projected to deliver at least 96% of contracted UDAs](#UDA-projection)
 * [Percentage of CoTs assisted by Dental Care Practitioners (DCPs)](#dcp-fp17)
 * [Percentage of UDAs assisted by Dental Care Practitioners (DCPs) by band](#dcp-uda)
 * [Percentage of FP17s indicating low oral health risk](#bpe)
 * [111 call volumes](#111-call-volumes)
 * [Unique patients seen rolling 12 months](#unique-patients)
 * [Unique patients seen rolling 12 months as % of April 2018 delivery](#unique-patients-index)
 * [Number of new patients](#new-patients)
 * [Percentage of practices seeing new patients](#new-patients-perc)
 * [Patient re-attendance intervals](#reattendance)
 * [BSA CDS dashboard - opens in web](https://miteam.shinyapps.io/CDS_Dashboard/)
 * [Contract closures based on PCAR report](#closures)
 * [De-commissioned and re-commissioned UDAs and UOAs as a result of closure based on PCAR](#de-and-re-commissioned)
 * [Total payments to dentists by financial year](#payemts)
 * [Cumulative financial value of UDAs delivered YTD](#uda-value)


---

name: contents
#### Contents 2

 <font size="2">
#### Orthodontic 
 * [UOA activity](#uoa-activity)
 * [UOA activity by MY category](#uoa-activity-my-cat)
 * [Cumulative UOA delivery per quarter](#cumulative-uoas)
 * [YTD UOA delivery](#YTD-uoas)
 * [UOA delivery profile across months](#uoa-delivery-profile)
 
#### Appendix
 * [MY Category classification breakdown](#my-cat-breakdown)
 * [Data sources](#data-sources)
 

<font size="1">
#### NOTE 
This is an interactive markdown report.  You can navigate from slide to slide by either clicking the mouse on the screen or by using the cursor keys.  **Press ? for help.** Some pages have selection buttons across regions, click on the region in order to explore the data for that area.  

---

### Treatment month data

All analyses in this report now only use **treatment month data extracted on the 10th of the month**. 

<font size="2">
#### Treatment month data explanation

* Treatment month data is based on courses of treatment completed within an entire month, for example 1st February to 28th Feb
* Contractors have two months to submit FP17 forms relating to a course of treatment (CoT). For example, with treatment month data, if a COT was completed in February but not submitted until March, that activity would still be registered as occurring in February.
* This means that graphs using treatment month data may change for historical months as more COTs are registered.
* Extracting this data on the 10th of the month aims to minimise the amount that recent historical data with change.


---
name: contracts-table

```{css, echo=F}
    /* Table width = 100% max-width */

    .remark-slide table{
        width: 100%;
    }

    /* Change the background color to white for shaded rows (even rows) */

    .remark-slide thead, .remark-slide tr:nth-child(2n) {
        background-color: white;
    }
```

### Number of contracts by Mid-Year (MY) category
(see appendix for category descriptions)

```{r xaringan-panelset-contracts, echo=FALSE}
xaringanExtra::use_panelset()
```
 <font size="2">
.panelset[

.panel[.panel-name[National]

#### Excluding Foundation Dentists, On-time submissions
```{r table11, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "National", region_STP_name = NULL), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table21, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable( table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = F, level = "National", region_STP_name = NULL), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


]
.panel[.panel-name[South East]

#### Excluding Foundation Dentists, On-time submissions
```{r table12, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "South East"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table22, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "South East"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



]
.panel[.panel-name[South West]

#### Excluding Foundation Dentists, On-time submissions
```{r table13, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "South West"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table23, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "South West"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



]
.panel[.panel-name[North West]

#### Excluding Foundation Dentists, On-time submissions
```{r table14, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "North West"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table24, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "North West"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



]
.panel[.panel-name[North East and Yorkshire]

#### Excluding Foundation Dentists, On-time submissions
```{r table15, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "North East and Yorkshire"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table25, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "North East and Yorkshire"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



]
.panel[.panel-name[London]

#### Excluding Foundation Dentists, On-time submissions
```{r table16, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "London"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table26, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "London"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```


]
.panel[.panel-name[Midlands]

#### Excluding Foundation Dentists, On-time submissions
```{r table17, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "Midlands"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table27, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "Midlands"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



]
.panel[.panel-name[East of England]

#### Excluding Foundation Dentists, On-time submissions
```{r table18, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_non_FD_Apr23, remove_prototypes = F, level = "Regional", region_STP_name = "East of England"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```

#### Foundations dentists only, On-time submissions
```{r table28, echo = FALSE, warning = FALSE, message = FALSE}
knitr::kable(table_number_cat_contracts(data = UDA_treatment_month_FD_Apr23, remove_prototypes = T, level = "Regional", region_STP_name = "East of England"), format = 'html') %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



]
]

"Category not known" is mostly made up of new contracts which have not yet been assigned a category as of the last Mid Year update. 

[Return to contents](#contents)

---

name: short-uda-activity

### UDA Activity Data

```{r xaringan-panelset-UDA-activity, echo=FALSE}
xaringanExtra::use_panelset()
```
 <font size="2">
.panelset[

.panel[.panel-name[National]
```{r UDA_activity_Calendar1, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               level = "National",
                                               region_STP_name = NULL,
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE)
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "National", region_STP_name = NULL)`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[South East]
```{r UDA_activity_Calendar2, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Regional",
                                  region_STP_name = "South East")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "South East")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[South West]
```{r UDA_activity_Calendar3, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Regional",
                                  region_STP_name = "South West")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "South West")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[North West]
```{r UDA_activity_Calendar4, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Regional",
                                  region_STP_name = "North West")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "North West")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[North East and Yorkshire]
```{r UDA_activity_Calendar5, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Regional",
                                  region_STP_name = "North East and Yorkshire")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "North East and Yorkshire")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[London]
```{r UDA_activity_Calendar6, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Regional",
                                  region_STP_name = "London")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "London")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[Midlands]
```{r UDA_activity_Calendar7, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Regional",
                                  region_STP_name = "Midlands")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "Midlands")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).


]
.panel[.panel-name[East of England]
```{r UDA_activity_Calendar8, echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_historic_UDA_UOA_delivery_treatment_month(data = UDA_treatment_month_non_FD_Apr23,
                                               scheduled_data = UDA_scheduled_data, 
                                               historic_data = historical_UDA_scheduled_data,
                                               contractor_cats = contractor_categories,
                                               UDAorUOA = "UDA",
                                               plotChart = TRUE, 
                                               all_regions_and_STPs = FALSE,
                                               include_historic = TRUE,
                                  level = "Region",
                                  region_STP_name = "East of England")
```

* This graph shows the average monthly performance of the **`r get_num_contracts(level = "Regional", region_STP_name = "East of England")`** GDS/PDS/PDS+ contracts scaled up by 12 months measured against the delivery thresholds (60% for Apr-Sep 21, 65% for Oct-Dec, 85% for Jan-Mar, 95% for Apr-Jun 22 and 100% going forward).

]
]

[Return to contents](#contents)

---

name: short-uda-activity-my-cat

### UDA activity data by MY Category
#### Prototypes and contracts with annual contracted UDAs < 100 included

```{r xaringan-panelset-UDA-activity-My-CAT, echo=FALSE}
xaringanExtra::use_panelset()
```
 <font size="2">
.panelset[

.panel[.panel-name[National]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             level = "National",
                                             region_STP_name = NULL,
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE)
```

]
.panel[.panel-name[South East]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "South East")
```


]
.panel[.panel-name[South West]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "South West")
```


]
.panel[.panel-name[North West]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "North West")
```


]
.panel[.panel-name[North East and Yorkshire]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "North East and Yorkshire")
```


]
.panel[.panel-name[London]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "London")
```


]
.panel[.panel-name[Midlands]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "Midlands")
```


]
.panel[.panel-name[East of England]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_MY_cat_treatment_month(data = UDA_treatment_month_non_FD_Apr23, 
                                             contractor_cats = contractor_categories,
                                             UDAorUOA = "UDA",
                                             remove_prototypes = FALSE,
                                             regional_lines = FALSE, 
                                             STP_lines = FALSE,
                                             cat_lines = TRUE,
                                             plotChart = TRUE,
                                  level = "Regional",
                                  region_STP_name = "East of England")
```


]
]

[Return to contents](#contents)

---

name: YTD-udas

### YTD UDA delivery

```{r xaringan-panelset-UDA-activity_YTD, echo=FALSE}
xaringanExtra::use_panelset()
```
 <font size="2">
.panelset[

.panel[.panel-name[National]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  level = "National",
                                  region_STP_name = NULL,
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE)
```


]
.panel[.panel-name[South East]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Regional",
                                  region_STP_name = "South East")
```


]
.panel[.panel-name[South West]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Regional",
                                  region_STP_name = "South West")
```


]
.panel[.panel-name[North West]
```{r  echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Regional",
                                  region_STP_name = "North West")
```


]
.panel[.panel-name[North East and Yorkshire]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Regional",
                                  region_STP_name = "North East and Yorkshire")
```


]
.panel[.panel-name[London]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Regional",
                                  region_STP_name = "London")
```


]
.panel[.panel-name[Midlands]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Regional",
                                  region_STP_name = "Midlands")
```


]
.panel[.panel-name[East of England]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5, fig.align='center'}
plot_YTD_UDA_UOA_delivery(data = UDA_treatment_month_non_FD_Apr23, 
                                  
                                  historic_data = historical_UDA_scheduled_data,
                                  UDAorUOA = "UDA",
                                  remove_prototypes = TRUE, 
                                  plotChart = TRUE, 
                                  all_regions_and_STPs = FALSE,
                                  level = "Region",
                                  region_STP_name = "East of England")
```


]
]

[Return to contents](#contents)

---

name: uda-delivery-profile

### UDA delivery profile

```{r xaringan-panelset-UDA_delivery_profile, echo=FALSE}
xaringanExtra::use_panelset()
```
 <font size="2">
.panelset[

 .panel[.panel-name[National]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "National",
                          region_STP_name = NULL,
                          include_historic = FALSE)
```

* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "National", region_STP_name = NULL, get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "National", region_STP_name = NULL, get_num_above = 95)[1]) *100 / get_num_contracts(level = "National", region_STP_name = NULL))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "National", region_STP_name = NULL, get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "National", region_STP_name = NULL, get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "National", region_STP_name = NULL, get_num_above = 100)[2]`**
UDAs.

 ]
 .panel[.panel-name[South East]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "South East",
                          include_historic = FALSE)
```

* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South East", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South East", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "South East"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South East", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South East", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South East", get_num_above = 100)[2]`**
UDAs.

 ]
 .panel[.panel-name[South West]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "South West",
                          include_historic = FALSE)
```


* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South West", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South West", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "South West"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South West", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South West", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "South West", get_num_above = 100)[2]`**
UDAs.


 ]
 .panel[.panel-name[North West]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "North West",
                          include_historic = FALSE)
```


* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North West", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North West", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "North West"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North West", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North West", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North West", get_num_above = 100)[2]`**
UDAs.


 ]
 .panel[.panel-name[North East and Yorkshire]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "North East and Yorkshire",
                          include_historic = FALSE)
```


* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North East and Yorkshire", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North East and Yorkshire", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "North East and Yorkshire"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North East and Yorkshire", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North East and Yorkshire", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "North East and Yorkshire", get_num_above = 100)[2]`**
UDAs.

 ]
.panel[.panel-name[London]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "London",
                          include_historic = FALSE)
```

* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "London", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "London", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "London"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "London", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "London", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "London", get_num_above = 100)[2]`**
UDAs.

 ]
 .panel[.panel-name[Midlands]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "Midlands",
                          include_historic = FALSE)
```



* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "Midlands", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "Midlands", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "Midlands"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "Midlands", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "Midlands", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "Midlands", get_num_above = 100)[2]`**
UDAs.

 ]
 .panel[.panel-name[East of England]
```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "Regional",
                          region_STP_name = "East of England",
                          include_historic = FALSE)
```


* The number of contracts delivering above 95% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "East of England", get_num_above = 95)[1]`**
(
**`r round(as.numeric(plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "East of England", get_num_above = 95)[1]) *100 / get_num_contracts(level = "Regional", region_STP_name = "East of England"))`**
% of contracts),
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "East of England", get_num_above = 95)[2]`**
UDAs.
* The number of contracts delivering above 100% contracted value for this month is
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "East of England", get_num_above = 100)[1]`**,
with a mean contract size of
**`r plot_delivery_vs_contract_size_scatter_corporate(level = "Regional", region_STP_name = "East of England", get_num_above = 100)[2]`**
UDAs.


 ]
 .panel[.panel-name[Data]

<font size="1">

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}

data <- plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "National",
                          region_STP_name = NULL,
                          plotChart = F,
                          all_regions_and_STPs = T)

data %>%
  download_this(
    output_name = "UDA_delivery_profile_data",
    output_extension = ".xlsx",
    button_label = "Download data",
    button_type = "warning",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
reactable(
  plot_UDA_UOA_delivery_profile(data = UDA_treatment_month_non_FD_Apr23,
                          
                          UDAorUOA = "UDA",
                          level = "National",
                          region_STP_name = NULL,
                          plotChart = F,
                          all_regions_and_STPs = T),
  filterable = TRUE,
  paginateSubRows = TRUE,
  minRows = 5,
  highlight = TRUE,
  groupBy = c("Month", "Performance band", "Region Name"),
  columns = list(
    `Total number of contracts`= colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE),
    `Number of contracts in performance band` = colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE)#,
    #`Percentage of contracts in performance band` = colDef(aggregate = "mean", format = colFormat(suffix = "%", digits = 1), filterable = FALSE)
  )
)
```
 ]
 ]
 
 This graph shows the proportion of practices delivering
between a certain % group of contracted UDA activity if performance for that
month is annualised. Improvement would be seen as the distribution moving towards the right, as more contracts deliver closer to 100% of their contracted UDAs.

[Return to contents](#contents)

---

name: banded-cots

### Time series of banded Courses of Treatment

```{r xaringan-panelset-CoTs, echo=FALSE}
xaringanExtra::use_panelset()
```
 <font size="2">
.panelset[

 .panel[.panel-name[National]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "National",
                region_STP_name = NULL)
```


 ]
 .panel[.panel-name[South East]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "South East")
```

 ]
 .panel[.panel-name[South West]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "South West")
```

 ]
 .panel[.panel-name[North West]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "North West")
```

 ]
 .panel[.panel-name[North East and Yorkshire]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "North East and Yorkshire")
```

 ]
.panel[.panel-name[London]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "London")
```

 ]
 .panel[.panel-name[Midlands]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "Midlands")
```


 ]
 .panel[.panel-name[East of England]
```{r echo = FALSE, warning = FALSE, message = FALSE, , fig.width=14, fig.height=5}
plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "Regional",
                region_STP_name = "East of England")
```

 ]
  .panel[.panel-name[Data]

<font size="1">

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}

data <- plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "National",
                region_STP_name = NULL,
                plotChart = F,
                all_regions_and_STPs = T)

data %>%
  download_this(
    output_name = "banded_CoT_data",
    output_extension = ".xlsx",
    button_label = "Download data",
    button_type = "warning",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

```{r echo = FALSE, warning = FALSE, message = FALSE, fig.width=14, fig.height=5}
reactable(
  plot_banded_CoT(data = UDA_treatment_month_non_FD_Apr23,
                
                historic_data = historical_UDA_scheduled_data,
                remove_prototypes = FALSE,
                level = "National",
                region_STP_name = NULL,
                plotChart = F,
                all_regions_and_STPs = T),
  height = 400,
  filterable = TRUE,
  paginateSubRows = TRUE,
  minRows = 5,
  highlight = TRUE,
  groupBy = c("Month", "Region Name"),
  columns = list(
    `Band 1`= colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE),
    `Band 2` = colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE),
    `Band 3`= colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE),
    `Urgent` = colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE),
    `Other`= colDef(aggregate = "sum", format = colFormat(digits = 0), filterable = FALSE)
  )
)
```
]
 ]

[Return to contents](#contents)


---

name: my-cat-breakdown

### Appendix
#### MY Category classification breakdown:

 <font size="2">

* Cat 1
  + Details in CoMPASS Correct
* Cat 2
  + Carry Forward - Other
  + Flexibly Commissioned Contract
  + Force majeure accepted
  + Force majeure o/s
  + In-year incorporation/merge (Parent contract - letter will be sent)
  + Incomplete OOH/other access services
  + Late subs processed
  + Mixed / CoT Contract
  + Non-recurring activity
  + Open in-year
  + Other
  + Request to re-base
  + Review Carry Forward
  + Sub Contracts (Parent contract - letter will be sent)
  + UDA Value below 15.00
  + UDA Value exceeds 49.99
  + UDC
  + UOA Value exceeds 75.00
  + Closed in-year
  + Incomplete service line entries

---

 <font size="2">

* Cat 3
  + CDS
  + Closed in year
  + Contract End Date before 01/04/2020
  + Contract End Date before 01/04/2021
  + Contract End Date before 01/04/2022
  + DCO req to resolve locally
  + Domiciliary/ Sedation
  + IMOS/MOS
  + In-year incorporation/merge (Child contract - letter will not be sent)
  + Incomplete OOH/other access services
  + Known performance/contract issues
  + No Contracted activity
  + No Contracted value
  + Not paid by the NHSBSA
  + Open in year
  + Other
  + Other - Please state why
  + Other Advanced/Additional Services
  + PDS Plus
  + Prison
  + Sub Contracts (Child contract - letter will not be sent)
* Cat 4
  + Dental Contract Reform

---

name: data-sources

#### Data sources

 <font size="2">
* BSA calendar and scheduled UDA data downloaded from the "NHS England Central Dashboard" on eDEN. This data is downloaded monthly and put on the NCDR.
* Tables are:
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UDA_calendar]
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UDA_scheduled]
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UOA_calendar]
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UOA_scheduled]
* Historical data going back to April 2016 is saved here:
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UDA_scheduled_historical]
* A list of prototype contracts are also available in:
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[prototype_contracts]
* Tables of UDA delivery on STP/ICB level in calendar and scheduled format available in:
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UDA_delivery_calendar]
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[UDA_delivery_scheduled]

* 111 data comes from the pathways tool which is received monthly by email.
* Rolling unique patients data is received monthly by email from the BSA and saved on the NCDR in the following table:
  + [NHSE_Sandbox_PrimaryCareNHSContracts].[Dental].[unique_patients_rolling_12_month]
* CDS data is downloaded from the [CDS dashboard](https://miteam.shinyapps.io/CDS_Dashboard/)
* Payments to dentists data comes from the publicly available [BSA data](https://www.nhsbsa.nhs.uk/dental-data/nhs-payments-dentists)




<!--  ```{r xaringan-panelset-UDA-activity, echo=FALSE} -->
<!--  xaringanExtra::use_panelset() -->
<!--  ``` -->
<!--   <font size="2"> -->
<!--  .panelset[ -->

<!--  .panel[.panel-name[National] -->


<!--  ] -->
<!--  .panel[.panel-name[South East] -->



<!--  ] -->
<!--  .panel[.panel-name[South West] -->



<!--  ] -->
<!--  .panel[.panel-name[North West] -->



<!--  ] -->
<!--  .panel[.panel-name[North East and Yorkshire] -->



<!--  ] -->
<!-- .panel[.panel-name[London] -->


<!--  ] -->
<!--  .panel[.panel-name[Midlands] -->



<!--  ] -->
<!--  .panel[.panel-name[East of England] -->



<!--  ] -->
<!--  ] -->


<!-- --- -->






